# EscapeHint 도메인 정의서

## 1. 서비스 개요

### 1.1 비즈니스 목적

방탈출 카페에서 플레이어들에게 실시간으로 힌트를 제공하는 웹 애플리케이션. 고객은 힌트 코드를 입력하여 필요한 힌트를 받고, 관리자는 테마별 힌트를 효율적으로 관리할 수 있습니다.

### 1.2 핵심 가치

- **고객 관점**: 직관적인 UI로 게임 몰입도 유지하면서 필요한 힌트 즉시 확인
- **관리자 관점**: 테마별 힌트 손쉬운 등록/수정, 비공개 관리 인터페이스
- **운영 관점**: 게임 진행률 추적, 힌트 사용 통계 확인

### 1.3 사용자 유형

- **플레이어(Customer)**: 방탈출 게임을 플레이하는 고객
- **관리자(Admin)**: 테마 및 힌트를 관리하는 운영자

---

## 2. 핵심 도메인 모델

### 2.1 엔티티 정의

#### Theme (테마)

방탈출 게임의 테마 정보

```
- id: 고유 식별자
- name: 테마 이름
- description: 테마 설명
- playTime: 제한 시간 (분 단위)
- isActive: 활성화 상태
- createdAt: 등록 일시
- updatedAt: 수정 일시
```

#### Hint (힌트)

특정 테마에 속한 힌트 정보

```
- id: 고유 식별자
- themeId: 소속 테마 ID
- code: 힌트 코드 (고객이 입력하는 값)
- content: 힌트 내용 (텍스트)
- answer: 정답 내용 (텍스트)
- progressRate: 진행률 (0-100%)
- order: 순서
- isActive: 활성화 상태
- createdAt: 등록 일시
- updatedAt: 수정 일시
```

#### GameSession (게임 세션)

진행 중인 게임 세션 정보

```
- id: 고유 식별자
- themeId: 플레이 중인 테마 ID
- startTime: 시작 시간
- endTime: 종료 시간
- usedHintCount: 사용한 힌트 수
- usedHintCodes: 사용한 힌트 코드 목록
- status: 세션 상태 (진행중/완료/중단)
```

### 2.2 도메인 관계도

```
Theme (1) ---> (N) Hint
  |
  |
 (1)
  |
 (N)
GameSession
```

### 2.3 주요 값 객체(Value Objects)

- **HintCode**: 힌트 접근을 위한 고유 코드 (예: "HINT01", "H-MIRROR")
- **ProgressRate**: 게임 진행률 (0-100%, 5% 단위 권장)
- **PlayTime**: 남은 플레이 시간 (분:초 형식)

---

## 3. 주요 유스케이스

### 3.1 고객(플레이어) 유스케이스

#### UC-01: 게임 세션 시작

- **목적**: 특정 테마의 게임 시작 및 타이머 시작
- **절차**:
  1. 테마 선택 화면 진입
  2. 테마 선택
  3. 게임 세션 생성 및 타이머 시작
- **결과**: 힌트 입력 화면 표시, 타이머 작동

#### UC-02: 힌트 조회

- **목적**: 힌트 코드를 입력하여 힌트 확인
- **절차**:
  1. 힌트 코드 입력
  2. 코드 검증
  3. 힌트 내용, 진행률, 정답보기 버튼 표시
  4. 사용한 힌트 수 증가
- **결과**: 힌트 내용 표시, 게임 진행률 업데이트

#### UC-03: 정답 확인

- **목적**: 힌트의 정답 확인
- **절차**:
  1. 정답보기 버튼 클릭
  2. 정답 내용 표시
- **결과**: 정답 텍스트 표시

#### UC-04: 플레이 정보 확인

- **목적**: 현재 게임 진행 상태 확인
- **표시 정보**:
  - 남은 플레이 시간 (실시간 타이머)
  - 사용한 힌트 수
  - 현재 진행률

### 3.2 관리자 유스케이스

#### UC-05: 관리자 모드 진입

- **목적**: 비밀스러운 방법으로 관리자 화면 접근
- **방법**: 특수 제스처, 숨겨진 버튼 조합, 또는 특정 코드 입력
- **결과**: 관리자 대시보드 진입

#### UC-06: 테마 관리

- **기능**:
  - 테마 등록: 이름, 설명, 제한시간 설정
  - 테마 수정: 정보 업데이트
  - 테마 활성화/비활성화
  - 테마 목록 조회
- **검증**: 테마 이름 중복 방지, 제한시간 유효성 검사

#### UC-07: 힌트 관리

- **기능**:
  - 힌트 등록: 코드, 내용, 정답, 진행률 입력
  - 힌트 수정: 정보 업데이트
  - 힌트 삭제
  - 힌트 순서 조정
  - 힌트 목록 조회 (테마별)
- **검증**: 힌트 코드 중복 방지(테마 내), 진행률 유효성 검사

#### UC-08: 게임 세션 모니터링

- **기능**:
  - 진행 중인 세션 목록 조회
  - 세션별 힌트 사용 현황 확인
  - 세션 강제 종료

---

## 4. 도메인 규칙

### 4.1 비즈니스 규칙

#### BR-01: 힌트 코드 고유성

- 동일 테마 내에서 힌트 코드는 중복될 수 없음
- 다른 테마 간에는 동일한 코드 사용 가능

#### BR-02: 진행률 제약

- 진행률은 0% ~ 100% 범위 내
- 힌트는 진행률 순서대로 제공 권장 (강제는 아님)
- 100% 진행률은 최종 힌트 또는 정답 의미

#### BR-03: 게임 세션 관리

- 하나의 세션은 하나의 테마만 플레이
- 세션 시작 시 타이머 자동 시작
- 제한 시간 초과 시 타이머는 계속 진행 (음수 표시), 세션은 자동 종료되지 않음

#### BR-04: 힌트 사용 추적

- 동일한 힌트 코드를 여러 번 입력해도 카운트는 1회만 증가
- 사용한 힌트 코드는 세션에 기록

#### BR-05: 관리자 접근 보안

- 관리자 모드 진입 방법은 고객에게 노출되지 않음
- 예시: 특정 영역 5회 연속 탭, 특정 키 조합, 비공개 URL

#### BR-06: 힌트 코드 검증 실패 처리

- **존재하지 않는 코드**: "힌트를 찾을 수 없습니다" 메시지 표시
- **비활성화된 힌트**: 관리자만 확인 가능, 고객에게는 "현재 사용할 수 없는 힌트입니다" 표시
- **다른 테마의 코드**: "현재 테마에서 사용할 수 없는 코드입니다" 표시
- **연속 실패 제한**: 연속 5회 실패 시 30초 쿨다운 적용 (선택사항)

#### BR-07: 세션 예외 상황

- **브라우저 새로고침**: 세션 ID 유지로 상태 복구 (로컬 스토리지 활용)
- **세션 만료**: 2시간 무활동 시 자동 종료 상태로 전환
- **중복 세션**: 동일 테마 동시 진행 허용 (별도 세션으로 관리)

#### BR-08: 게임 완료 조건

- **클리어**: 플레이어가 "게임 종료" 버튼 클릭 시 `status='completed'`로 변경
- **중단**: 관리자가 강제 종료 시 `status='aborted'`
- **진행중**: 위 조건 외 모든 경우 `status='in_progress'`
- **통계 산정**: 제한시간 내 클리어한 세션만 "성공"으로 집계
- **제한시간 초과**: 타이머는 계속 진행 (예: -02:30으로 표시), 세션은 자동 종료되지 않음

#### BR-09: 엣지 케이스 처리

- **힌트 없는 테마**: 게임 시작 가능, "힌트 준비중입니다" 메시지 표시
- **세션 없이 코드 입력**: 자동으로 세션 생성 후 힌트 표시 (UX 개선)
- **비활성 테마 선택**: 고객 화면에서 숨김, 관리자는 "비활성" 배지와 함께 표시
- **동일 코드 재입력**: 힌트 재표시, 카운트 증가 없음 (BR-04 보완)

### 4.2 데이터 검증 규칙

#### VR-01: Theme 검증

- **name**: 필수, 1-50자
  - ✅ 유효: "좀비 연구소", "시간 여행자의 방"
  - ❌ 무효: "" (빈 문자열), 51자 이상
  - 처리: 범위 외 값은 400 Bad Request 반환
- **playTime**: 필수, 10-180분 범위
  - ✅ 유효: 60, 90, 120
  - ❌ 무효: 5, 200, -10
  - 처리: 범위 외 값은 400 Bad Request 반환, 경고 메시지 포함

#### VR-02: Hint 검증

- **code**: 필수, 2-20자, 영숫자 및 하이픈(-) 허용
  - ✅ 유효: "HINT01", "H-MIRROR", "ab"
  - ❌ 무효: "A" (1자), "CODE123456789012345" (21자), "HINT 01" (공백 포함)
  - 처리: 입력 시 대문자 변환 후 저장 (hint01 → HINT01)
  - 중복 체크: 동일 테마 내에서만 유니크 제약, 409 Conflict 반환
- **content**: 필수, 1-500자
  - ✅ 유효: "거울 뒤를 확인하세요"
  - ❌ 무효: "" (빈 문자열), 501자 이상
- **answer**: 필수, 1-200자
  - ✅ 유효: "비밀번호는 1234입니다"
  - ❌ 무효: "" (빈 문자열), 201자 이상
- **progressRate**: 필수, 0-100 정수
  - ✅ 유효: 0, 50, 100
  - ❌ 무효: -1, 101, 50.5 (소수), "50" (문자열)
  - 처리: 범위 외 값은 400 Bad Request 반환

#### VR-03: GameSession 검증

- **themeId**: 필수, 유효한 테마 ID
  - ✅ 유효: 존재하는 Theme의 id 값
  - ❌ 무효: 존재하지 않는 ID, null
  - 처리: 404 Not Found 반환
- **startTime**: 필수, 현재 시간 기준
  - ✅ 유효: 현재 시간의 ISO 8601 형식 (예: 2025-11-25T10:30:00Z)
  - ❌ 무효: 미래 시간, 잘못된 형식
  - 처리: 서버에서 자동 생성 권장

---

## 5. 기술적 고려사항

### 5.1 아키텍처 권장사항

#### 프론트엔드

- **기술**: React 또는 Vue.js 기반 SPA
- **상태 관리**: 세션 정보, 타이머, 힌트 사용 이력 관리 필요
- **UI/UX**:
  - 고객 화면: 큰 글자, 직관적인 버튼, 몰입 방해 최소화
  - 관리자 화면: 효율적인 CRUD 인터페이스, 드래그앤드롭 순서 조정
- **반응형**: 태블릿, 모바일 지원 필수

#### 백엔드

- **API 구조**: RESTful API
- **데이터베이스**:
  - 관계형 DB (PostgreSQL, MySQL) 권장
  - 세션 데이터는 Redis 캐시 고려
- **인증**: 관리자 모드는 세션 기반 또는 JWT 인증

### 5.2 주요 기능별 고려사항

#### 타이머 기능

- 클라이언트 측 타이머 (정확도 우선)
- 서버 시간과 주기적 동기화 (60초마다)
- 백그라운드 탭에서도 정상 작동 보장

#### 힌트 코드 입력

- 대소문자 구분 없이 처리
- 실시간 검증 또는 엔터키/버튼 클릭 시 검증
- 잘못된 코드 입력 시 명확한 오류 메시지

#### 관리자 모드 진입

- 옵션 1: 숨겨진 UI 요소 (특정 영역 연속 탭)
- 옵션 2: 특수 힌트 코드 입력 (예: "ADMIN2024")
- 옵션 3: URL 쿼리 파라미터 + 비밀번호

#### 데이터 동기화

- 관리자가 힌트 수정 시 진행 중인 세션에 실시간 반영 불필요
- 새 세션 시작 시 최신 데이터 로드

### 5.3 성능 고려사항

- 힌트 데이터는 세션 시작 시 한 번에 로드
- 이미지/비디오 힌트는 향후 확장 고려
- 동시 접속 세션 수는 방탈출 카페 규모에 따라 제한적 (일반적으로 10개 이하)

### 5.4 보안 고려사항

- 관리자 인증 토큰 안전한 저장
- 힌트 데이터 API는 세션 검증 후 제공
- XSS 방지를 위한 힌트 텍스트 이스케이프 처리
- HTTPS 통신 필수

### 5.5 확장 가능성

- 다국어 지원 (힌트 텍스트 다국어 버전)
- 힌트 타입 확장 (이미지, 오디오, 비디오)
- 통계 및 분석 기능 (테마별 평균 힌트 사용 수, 클리어율)
- 여러 방/세션 동시 관리

### 5.6 품질 속성 메트릭

#### 성능

- **API 응답시간**: P95 < 200ms (모든 엔드포인트)
- **타이머 정확도**: 60초당 ±500ms 이내
- **동시 세션**: 최대 20개, 각 세션 응답시간 영향 없음

#### 사용성

- **고객 힌트 조회**: 3클릭 이내 (코드 입력 → 제출 → 힌트 표시)
- **관리자 힌트 등록**: 5분 이내 (테마당 10개 힌트 기준)
- **모바일 반응속도**: 터치 후 100ms 이내 시각적 피드백

#### 신뢰성

- **세션 데이터 보존**: 브라우저 새로고침 시에도 100% 유지
- **타이머 백그라운드 정확도**: 탭 전환 후 복귀 시 ±2초 이내
- **데이터 손실률**: 0% (로컬 스토리지 + 서버 동기화)

---

## 6. 용어 사전

| 용어        | 영문          | 정의                                                            |
| ----------- | ------------- | --------------------------------------------------------------- |
| 테마        | Theme         | 방탈출 게임의 하나의 콘텐츠 단위 (예: 좀비 연구소, 시간 여행자) |
| 힌트        | Hint          | 게임 진행을 돕기 위한 단서 정보                                 |
| 힌트 코드   | Hint Code     | 힌트에 접근하기 위해 입력하는 고유 코드                         |
| 진행률      | Progress Rate | 해당 힌트를 받았을 때의 게임 진행 정도 (%)                      |
| 세션        | Game Session  | 하나의 팀이 하나의 테마를 플레이하는 단위                       |
| 플레이 타임 | Play Time     | 게임 제한 시간 또는 남은 시간                                   |

---

## 7. 다음 단계

본 도메인 정의서를 바탕으로 다음 작업을 진행합니다:

1. **UI/UX 설계**: 고객 화면 및 관리자 화면 와이어프레임/목업
2. **API 명세서 작성**: RESTful API 엔드포인트 정의
3. **데이터베이스 스키마 설계**: ERD 및 테이블 정의
4. **기술 스택 선정**: 구체적인 프레임워크 및 라이브러리 결정
5. **개발 일정 수립**: 스프린트 계획 및 마일스톤 설정

---

## 8. 문서 변경 이력

| 버전 | 날짜       | 작성자                | 변경 내용                                                         | 승인자 |
| ---- | ---------- | --------------------- | ----------------------------------------------------------------- | ------ |
| 1.1  | 2025-11-25 | Architecture Reviewer | 아키텍처 리뷰 반영: 비기능 메트릭, 예외 처리 규칙, 검증 명세 추가 | -      |
| 1.0  | 2025-11-25 | Business Analyst      | 초안 작성                                                         | -      |

---

**문서 버전**: 1.1
**최종 수정일**: 2025-11-25
**작성자**: Business Analyst
**검토자**: Architecture Reviewer
